// routes/hello/[name].ts
export default eventHandler( async (event) => {
	const { userId } = event?.context?.params;
	const { theme } = event?.context?.query;

	const fetchuser = (userId) => {
		console.log(userId.value);
		return fetch(
			`https://api.stackexchange.com/2.3/users/${userId.value}?site=stackoverflow`
		)
	};

	const fetchAccountStats = (accountId:) => {
		return fetch(
			`https://api.stackexchange.com/2.3/users/${accountId.value}/associated`
		)
	};
	
		const user = await fetchuser(userId);
		const account = await fetchAccountStats(user?.items[0].account_id);

  const stats = {
    reputation: user.items[0].reputation,
    badges: user.items[0].badge_counts,
    account: account.items[0].site_name,
    account_id: account.items[0].account_id,
    account_url: account.items[0].site_url,
    badges: {
      gold: account.items[0].badge_counts.gold,
      silver: account.items[0].badge_counts.silver,
      bronze: account.items[0].badge_counts.bronze,
    },
    }

	const useTheme = theme => {
		switch (theme) {
			case 'light':
				return 'light';
			case 'dark':
				return 'dark';
			default:
				return 'light';
		}
	}
	const getIcon = (icon, color = '#000') => {
		switch (icon) {
			case 'question':
				return `<path fill="${color}" d="M64.049,114.172v-2l-0.006,2c-27.642,0-50.129-22.486-50.129-50.128c0-27.642,22.487-50.13,50.129-50.13  s50.129,22.488,50.129,50.13C114.172,91.686,91.687,114.172,64.049,114.172z M64.043,17.914c-25.436,0-46.129,20.694-46.129,46.13  c0,25.436,20.693,46.128,46.129,46.128h0.006c25.433,0,46.123-20.692,46.123-46.128C110.172,38.608,89.479,17.914,64.043,17.914z"/><g><path fill="${color}" d="M64.043,74.354c-1.104,0-2-0.896-2-2v-9.756c0-1.104,0.896-2,2-2c5.27,0,9.557-4.286,9.557-9.556   c0-5.271-4.287-9.56-9.557-9.56s-9.557,4.289-9.557,9.56c0,1.104-0.896,2-2,2s-2-0.896-2-2c0-7.477,6.081-13.56,13.557-13.56   S77.6,43.565,77.6,51.042c0,6.796-5.026,12.439-11.557,13.409v7.903C66.043,73.458,65.147,74.354,64.043,74.354z"/><circle fill="${color}" cx="64.042" cy="85.098" r="3.796"/></g>`
			case 'answer':
				return `<path fill="${color}" d="M25,11c0-4.963-4.037-9-9-9s-9,4.037-9,9c0,3.088,1.556,6.235,4,8.166V20h-1c-0.553,0-1,0.447-1,1v2c0,3.859,3.141,7,7,7   s7-3.141,7-7v-2c0-0.553-0.447-1-1-1h-1v-0.834C23.444,17.235,25,14.088,25,11z M21,23c0,2.757-2.243,5-5,5s-5-2.243-5-5v-1h1h8h1   V23z M13,20v-1.335c0-0.325-0.158-0.631-0.425-0.818C10.437,16.344,9,13.592,9,11c0-3.859,3.141-7,7-7s7,3.141,7,7   c0,2.592-1.437,5.344-3.575,6.847C19.158,18.034,19,18.34,19,18.665V20H13z"/><path fill="${color}" d="M19,12c0-0.553-0.447-1-1-1h-3V9h3c0.553,0,1-0.447,1-1s-0.447-1-1-1h-1V6c0-0.553-0.447-1-1-1s-1,0.447-1,1v1h-1   c-0.553,0-1,0.447-1,1v4c0,0.553,0.447,1,1,1h3v2h-3c-0.553,0-1,0.447-1,1s0.447,1,1,1h1v1c0,0.553,0.447,1,1,1s1-0.447,1-1v-1h1   c0.553,0,1-0.447,1-1V12z"/></g>`
			case 'reputation':
				return `<g id="Promoted"><path fill="${color}" d="M44.0156,45.197l-.0071.02c-.7031,2.0046-1.5782,4.4995-3.9845,5.2809a4.2663,4.2663,0,0,1-1.32.2062c-1.7457,0-3.2378-.9764-4.675-1.9628l3.5859,12.0972a1.3021,1.3021,0,0,0,2.3555.3154L42.5434,57A1.3018,1.3018,0,0,1,43.9,56.4078l4.7954.9372a1.302,1.302,0,0,0,1.37-1.9417Z"/><path fill="${color}" d="M24.5873,50.704a4.2677,4.2677,0,0,1-1.32-.2061c-2.2195-.7209-3.1333-2.8957-3.8139-4.8026l-5.7546,9.708a1.302,1.302,0,0,0,1.37,1.9417l4.7955-.9372A1.302,1.302,0,0,1,21.2209,57l2.5728,4.1539a1.3019,1.3019,0,0,0,2.3552-.3154L29.855,48.3362c-.143.097-.2808.1912-.4012.2741C27.9575,49.64,26.41,50.704,24.5873,50.704Z"/><path fill="${color}" d="M56.2544,24.71c0-2.4131-4.7523-4.0453-5.4594-6.2227-.7328-2.2565,2.1271-6.3656.76-8.2439-1.3807-1.8971-6.1814-.44-8.0784-1.82-1.8784-1.3672-1.9678-6.39-4.2244-7.123-2.1775-.7071-5.1933,3.281-7.6064,3.281S26.2173.5934,24.04,1.3005c-2.2566.7326-2.3461,5.7557-4.2244,7.1228-1.897,1.3805-6.6977-.0769-8.0784,1.82-1.367,1.8782,1.4927,5.9874.76,8.244-.707,2.1775-5.4595,3.81-5.4595,6.2229s4.7525,4.0453,5.46,6.2226c.7327,2.2565-2.1269,6.3656-.76,8.2439,1.3806,1.8971,6.1812.44,8.0783,1.82,1.8782,1.3671,1.9677,6.39,4.2244,7.123,2.1775.707,5.1932-3.281,7.6065-3.281s5.4287,3.988,7.6061,3.2811c2.2564-.7328,2.346-5.7559,4.2243-7.1228,1.8971-1.3806,6.6977.0768,8.0784-1.82,1.3671-1.8783-1.4926-5.9874-.76-8.244C51.5019,28.7557,56.2544,27.1235,56.2544,24.71ZM31.6521,37.8315A13.1212,13.1212,0,1,1,44.7733,24.71,13.1213,13.1213,0,0,1,31.6521,37.8315Z"/><path fill="${color}" d="M37.4145,21.5491H34.9513a1.3375,1.3375,0,0,1-1.2721-.9242l-.7612-2.3427a1.3376,1.3376,0,0,0-2.5442,0l-.7611,2.3427a1.3376,1.3376,0,0,1-1.2721.9242H25.8774a1.3375,1.3375,0,0,0-.7862,2.42l1.9928,1.448a1.3376,1.3376,0,0,1,.4858,1.4954l-.7612,2.3426A1.3376,1.3376,0,0,0,28.8669,30.75L30.86,29.3023a1.3373,1.3373,0,0,1,1.5724,0L34.4249,30.75a1.3376,1.3376,0,0,0,2.0582-1.4955l-.7612-2.3426a1.3378,1.3378,0,0,1,.486-1.4954l1.9928-1.448A1.3375,1.3375,0,0,0,37.4145,21.5491Z"/></g>`
	
			case 'so':
				return '<g id="stackoverflow_x2C__Stack_overflow"><g><rect fill="#FFB74D" height="2" width="13" x="9.5" y="23.5"/></g><g><rect fill="#FFB74D" height="2" transform="matrix(0.9763 0.2164 -0.2164 0.9763 4.6372 -3.0874)" width="13.001" x="9.913" y="18.626"/></g><g><rect fill="#FFB74D" height="2" transform="matrix(0.9063 0.4226 -0.4226 0.9063 8.0029 -6.185)" width="12.999" x="11.45" y="13.956"/></g><g><rect fill="#FFB74D" height="2" transform="matrix(0.7739 0.6334 -0.6334 0.7739 11.402 -10.5264)" width="13" x="13.942" y="9.704"/></g><g><rect fill="#FFB74D" height="2" transform="matrix(0.6087 0.7934 -0.7934 0.6087 15.0689 -16.2171)" width="13" x="17.476" y="6.168"/></g><g><g><polygon fill="#CFD8DC" points="25.5,20.5 25.5,28.5 6.5,28.5 6.5,20.5 4.5,20.5 4.5,30.5 27.5,30.5 27.5,20.5    "/></g><g><path d="M25.5,29h-19C6.224,29,6,28.776,6,28.5V21H4.5C4.224,21,4,20.776,4,20.5S4.224,20,4.5,20h2     C6.776,20,7,20.224,7,20.5V28h18v-3.5c0-0.276,0.224-0.5,0.5-0.5s0.5,0.224,0.5,0.5v4C26,28.776,25.776,29,25.5,29z" fill="#455A64"/></g><g><path d="M27.5,31h-23C4.224,31,4,30.776,4,30.5v-6C4,24.224,4.224,24,4.5,24S5,24.224,5,24.5V30h22v-9h-1.5     c-0.276,0-0.5-0.224-0.5-0.5s0.224-0.5,0.5-0.5h2c0.276,0,0.5,0.224,0.5,0.5v10C28,30.776,27.776,31,27.5,31z" fill="#455A64"/></g></g><g><path d="M22.5,26h-13C9.224,26,9,25.776,9,25.5v-2C9,23.224,9.224,23,9.5,23h10.958c0.276,0,0.5,0.224,0.5,0.5    s-0.224,0.5-0.5,0.5H10v1h12v-1.5c0-0.276,0.224-0.5,0.5-0.5s0.5,0.224,0.5,0.5v2C23,25.776,22.776,26,22.5,26z" fill="#455A64"/></g><g><path d="M22.543,22.51c-0.036,0-0.072-0.004-0.108-0.012L9.742,19.684c-0.129-0.029-0.242-0.108-0.313-0.22    s-0.095-0.248-0.066-0.377l0.434-1.953c0.06-0.269,0.318-0.437,0.597-0.38l10.567,2.343c0.27,0.06,0.439,0.327,0.38,0.597    c-0.06,0.269-0.324,0.44-0.597,0.38l-10.079-2.235l-0.217,0.977l11.716,2.598l0.324-1.464c0.06-0.269,0.318-0.439,0.597-0.38    c0.27,0.06,0.439,0.327,0.38,0.597l-0.433,1.953c-0.028,0.129-0.107,0.242-0.22,0.313C22.73,22.483,22.638,22.51,22.543,22.51z" fill="#455A64"/></g><g><path d="M23.418,19.109c-0.071,0-0.143-0.015-0.211-0.047l-11.781-5.494c-0.251-0.117-0.359-0.414-0.242-0.665    l0.845-1.813c0.056-0.12,0.157-0.213,0.282-0.258c0.125-0.046,0.262-0.04,0.382,0.017l9.743,4.543    c0.251,0.117,0.359,0.414,0.242,0.665c-0.117,0.251-0.416,0.357-0.664,0.242l-9.29-4.332l-0.423,0.906l10.875,5.071l0.635-1.359    c0.117-0.251,0.417-0.357,0.664-0.242c0.251,0.117,0.359,0.414,0.242,0.665l-0.846,1.813    C23.786,19.002,23.605,19.109,23.418,19.109z" fill="#455A64"/></g><g><path d="M24.839,16.095c-0.115,0-0.227-0.04-0.316-0.113L14.462,7.748c-0.214-0.175-0.245-0.49-0.07-0.703    l1.267-1.548c0.084-0.103,0.205-0.168,0.337-0.181c0.129-0.015,0.264,0.026,0.366,0.111l8.262,6.762    c0.214,0.175,0.245,0.49,0.07,0.704c-0.174,0.213-0.49,0.245-0.703,0.07l-7.875-6.445l-0.634,0.774l9.287,7.601l0.95-1.161    c0.175-0.215,0.49-0.245,0.703-0.07c0.214,0.175,0.245,0.49,0.07,0.703l-1.267,1.548c-0.084,0.103-0.205,0.168-0.337,0.181    C24.872,16.094,24.855,16.095,24.839,16.095z" fill="#455A64"/></g><g><path d="M27.139,13.434c-0.149,0-0.298-0.067-0.396-0.196L18.829,2.924c-0.081-0.105-0.116-0.238-0.1-0.37    c0.018-0.131,0.087-0.25,0.191-0.331l1.587-1.217c0.218-0.168,0.532-0.128,0.701,0.092l6.62,8.628    c0.168,0.219,0.127,0.533-0.092,0.701c-0.22,0.167-0.533,0.127-0.701-0.092L20.72,2.104l-0.793,0.608l7.305,9.521l1.189-0.913    c0.218-0.168,0.531-0.128,0.701,0.092c0.168,0.219,0.127,0.533-0.092,0.701l-1.587,1.217C27.353,13.4,27.245,13.434,27.139,13.434    z" fill="#455A64"/></g><g><g><g><g><g><g><g><path d="M5,22.5C5,22.775,4.775,23,4.5,23l0,0C4.225,23,4,22.775,4,22.5l0,0C4,22.225,4.225,22,4.5,22l0,0          C4.775,22,5,22.225,5,22.5L5,22.5z" fill="#455A64"/></g></g></g></g></g></g></g><g><g><g><g><g><g><g><path d="M26,22.5c0,0.275-0.225,0.5-0.5,0.5l0,0c-0.275,0-0.5-0.225-0.5-0.5l0,0c0-0.275,0.225-0.5,0.5-0.5          l0,0C25.775,22,26,22.225,26,22.5L26,22.5z" fill="#455A64"/></g></g></g></g></g></g></g></g>'
			default:
				return ''
		}
	}
	

	return {
		user,
    example: 'example userId found from stackoverflow https://stackoverflow.com/users/{{userID}}/{{username}}'
	};
});
